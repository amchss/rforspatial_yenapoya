{
  "hash": "eb3a73eeb8793ab64028ffa704f0f790",
  "result": {
    "engine": "knitr",
    "markdown": "---\nembed-resources: true\n---\n\n\n\n\n# Visualizing Spatial Data\n\n:::{style=\"text-align:justify\"}\n\nThe role of spatial data visualization in understanding distribution and determinants of a disease were classically demonstrated in John Snow's work in cholera epidemic of Golden Square, London in 1854 and maps have remained the most common applied aspect of spatial epidemiology till date. Maps enable real time visualizations. However, though the concepts of spatial data visualization has its historical roots in the practice of cartography^[The science and art of making maps], with the evolution of map making computational abilities, the requirement to know the cartography concepts for visualization spatial data for general use has decreased to minimal. For eg. we can point a location in Google maps and reach a destination without deliberations on cartographic concepts (such as northing, scale, etc). This has led to *neogeography*^[The process of map creation as primary objective but owing little to past cartographic traditions.] and thus crowd-sourced databases due to volunteer contributions.   \n\nIn professional and academic forums, the concepts of cartography are pre-requisites to meaningful spatial data visualization. Further, the concept of using visualization methods has evolved from just a tool for communication to the concept of visualization as an analysis tool. Visualization of spatial data is used to understand distribution patterns and generate hypothesis as well as for inferential procedures. The underlying principles in Scientific  visualization has led to use of visualization methods as complementary to statistical inference procedures in spatial epidemiology. For example, the interpretation of Moran's I^[Measure of spatial clustering. Details covered in \"Measures of Spatial Clustering\" session] is incomplete without accompanying visualization of dataset. The maps as analysis tools have several possible meanings and are thus polysemic in nature. \n\n\n\n### Expectations from the present session  \n\nIt is expected that by end of this session, students should be able to develop visualizations, understand and communicate epidemiological information, and develop hypothesis based on the visual representations of spatial datasets.\n\n:::\n\n\n## Graphic Variables  \n\n:::{style=\"text-align:justify\"}\n\n$Jacques$ $Bertin$, a french cartographer published a book $Semiologie$ $Graphique$, which brought forward concept of graphic variables. These variables highlight **methods using which different information can be obtained from the data**. The seven graphic variables as mentioned in $Semiology$ $of$ $graphics$ (English version) are as under:-  \n\n:::\n\n### Location  \n\n:::{style=\"text-align:justify\"}\n\nThe location of a spatial object varies with changing projections. It is important to understand that the transformation of CRS from geographic to projected, from raster to vector should be done with caution. The method of choice should be guided by the research objectives and need to preserve shape or location. \n\n:::\n\n### Value  \n\n:::{style=\"text-align:justify\"}\n\nThe value of a variable is related to the darkness/ lightness of a symbol. It is usually used for variables on an interval or ratio scale. Traditionally, higher values are depicted darker. \n\n:::\n\n### Color\n\n:::{style=\"text-align:justify\"}\n\nColor can be considered as most complex graphic variable. It represents varied sensations to different viewers. In addition, human eye is not equally sensitive across the spectrum of colors. Further, cultural affiliations, traditional representations and understandings provide challanges. A golden rule recommended is to first use color-blind friendly palettes. In the domain of Public Health, it is important to consider the color and its depiction during visualization to avoid ambiguous communication. For example: Color choice in vaccination coverage visualization as compared to color choice in obesity.\n \n:::\n\n### Size\n\n:::{style=\"text-align:justify\"}\n\nIn proportional symbol maps, the size of a symbol represents the difference in quantum of observations. The underlying type of data, classification adopted, transformations, and outlier management among others should be explored during visualizations. \n\n:::\n\n### Shape\n\n:::{style=\"text-align:justify\"}\n\nSimilar to size, choice of shape of the symbol can provide clarity or increase confusion, if not considered carefully. Different shapes can be provided to distinguish different types of variables. The same can be considered to distinguish sub-types of a variable. For example, dotted lines and solid lines can be used to distinguish roads from rivers but can also be used to distinguish main roads from side-roads. Understanding of datasets and variables help in deciding correct shapes for representation of data.\n\n:::\n\n### Space\n\n:::{style=\"text-align:justify\"}\n\nThe arrangement of symbols can also be used to represent differences. For example: In a dot map representing dengue occurrence data, space between the dots represent disease clustering, if any. Again, the interpretation of a variable needs careful consideration, as the case occurrence may be higher just because of underlying population figures and not otherwise.\n\n:::\n\n### Orientation\n\n:::{style=\"text-align:justify\"}\n\nUnderstanding the orientation of a pattern may provide critical insights into disease epidemiology. For eg. occurrence of a disease along with the course of a river may indicate risk factors associated with disease. \n\n:::\n\n## Map components\n\n### Map \n\nThe vector or raster map is central to map visualizations.\n\n### Title  \n\n:::{style=\"text-align:justify\"}\n\nA short and clear title must be provided. In addition, subtitles can be added, if required.\n\n:::\n\n### Distance and Scale.\n\n:::{style=\"text-align:justify\"}\n\nThere are two options for displaying information related to distance and scale in a map.   \n1. Display of a scale bar.  \n2. Use of x and y axes of the display as labeling axes. \n\n:::\n\n### Direction  \n\n:::{style=\"text-align:justify\"}\n\nSimilar to symbolism of scale, direction can be displayed as a symbol or can be implicit in the labeled axes. Conventionally, true North is provided as a symbol in maps.\n\n:::\n\n### Legend\n\n:::{style=\"text-align:justify\"}\n\nNot all maps require a legend. When present, due consideration to Graphic variables should be given.\n\n:::\n\n### Credits\n\n:::{style=\"text-align:justify\"}\n\nThe data sources, source of geospatial files should be provided. \n\n:::\n\n## Datasets used\n\n\n\n\n\n::: {.cell}\n\n:::\n\n\n\n\n\n### World map.  \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nworld <- read_rds(here::here( \"data\",\"world_india_compliant.rds\"))\n\nst_crs(world)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCoordinate Reference System:\n  User input: WGS 84 \n  wkt:\nGEOGCRS[\"WGS 84\",\n    DATUM[\"World Geodetic System 1984\",\n        ELLIPSOID[\"WGS 84\",6378137,298.257223563,\n            LENGTHUNIT[\"metre\",1]]],\n    PRIMEM[\"Greenwich\",0,\n        ANGLEUNIT[\"degree\",0.0174532925199433]],\n    CS[ellipsoidal,2],\n        AXIS[\"latitude\",north,\n            ORDER[1],\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n        AXIS[\"longitude\",east,\n            ORDER[2],\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n    ID[\"EPSG\",4326]]\n```\n\n\n:::\n:::\n\n\n\n\n### India map with state boundaries.  \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nindia <- readRDS(here::here(\"data\", \"india_states.rds\"))\n\nnames(india) <- epitrix::clean_labels(names(india))\n\nst_crs(india)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCoordinate Reference System:\n  User input: WGS 84 / Pseudo-Mercator \n  wkt:\nPROJCRS[\"WGS 84 / Pseudo-Mercator\",\n    BASEGEOGCRS[\"WGS 84\",\n        DATUM[\"World Geodetic System 1984\",\n            ELLIPSOID[\"WGS 84\",6378137,298.257223563,\n                LENGTHUNIT[\"metre\",1]]],\n        PRIMEM[\"Greenwich\",0,\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n        ID[\"EPSG\",4326]],\n    CONVERSION[\"Popular Visualisation Pseudo-Mercator\",\n        METHOD[\"Popular Visualisation Pseudo Mercator\",\n            ID[\"EPSG\",1024]],\n        PARAMETER[\"Latitude of natural origin\",0,\n            ANGLEUNIT[\"degree\",0.0174532925199433],\n            ID[\"EPSG\",8801]],\n        PARAMETER[\"Longitude of natural origin\",0,\n            ANGLEUNIT[\"degree\",0.0174532925199433],\n            ID[\"EPSG\",8802]],\n        PARAMETER[\"False easting\",0,\n            LENGTHUNIT[\"metre\",1],\n            ID[\"EPSG\",8806]],\n        PARAMETER[\"False northing\",0,\n            LENGTHUNIT[\"metre\",1],\n            ID[\"EPSG\",8807]]],\n    CS[Cartesian,2],\n        AXIS[\"easting (X)\",east,\n            ORDER[1],\n            LENGTHUNIT[\"metre\",1]],\n        AXIS[\"northing (Y)\",north,\n            ORDER[2],\n            LENGTHUNIT[\"metre\",1]],\n    USAGE[\n        SCOPE[\"unknown\"],\n        AREA[\"World - 85Â°S to 85Â°N\"],\n        BBOX[-85.06,-180,85.06,180]],\n    ID[\"EPSG\",3857]]\n```\n\n\n:::\n\n```{.r .cell-code}\n## Transform to Geog CRS as that of world map\nindia <- st_transform(india, crs = 4326)\n```\n:::\n\n\n\n\n### Kerala map with panchayat boundaries.  \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nkerala <- readRDS(here::here( \"data\",\"ker_panchayats.rds\"))\n\n## Clean names\nnames(kerala) <- epitrix::clean_labels(names(kerala))\n\n## Check CRS\nst_crs(kerala)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCoordinate Reference System:\n  User input: EPSG:4326 \n  wkt:\nGEOGCRS[\"WGS 84\",\n    DATUM[\"World Geodetic System 1984\",\n        ELLIPSOID[\"WGS 84\",6378137,298.257223563,\n            LENGTHUNIT[\"metre\",1]]],\n    PRIMEM[\"Greenwich\",0,\n        ANGLEUNIT[\"degree\",0.0174532925199433]],\n    CS[ellipsoidal,2],\n        AXIS[\"geodetic latitude (Lat)\",north,\n            ORDER[1],\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n        AXIS[\"geodetic longitude (Lon)\",east,\n            ORDER[2],\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n    USAGE[\n        SCOPE[\"unknown\"],\n        AREA[\"World\"],\n        BBOX[-90,-180,90,180]],\n    ID[\"EPSG\",4326]]\n```\n\n\n:::\n:::\n\n\n\n\n<!-- ### COVID-19 state wise aggregated datasets.   -->\n\n<!-- ```{r message=FALSE, warning=FALSE} -->\n<!-- covid <- data.table::fread(\"https://api.covid19india.org/csv/latest/state_wise_daily.csv\") -->\n<!-- ## Subset confirmed cases -->\n<!-- covid <- covid %>% filter(Status == \"Confirmed\") -->\n<!-- ## Tidy data format -->\n<!-- covid <- covid %>% pivot_longer(3:41, -->\n<!--                        names_to = \"state\", -->\n<!--                        values_to = \"cases\") -->\n<!-- ## Calculating cumulative cases -->\n<!-- covid <- covid %>% group_by(state) %>% mutate(cumsum = cumsum(cases)) -->\n<!-- ``` -->\n\n### Anonymised Dengue occurence point data from Trivandrum District. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Reading RDS\ndat <- readRDS(here::here( \"data\", \"dengue_sample.rds\"))\n\n## Cleaning names \ndat <- dat |> \n  janitor::clean_names()\n\n## Converting as sf object\ndat <- st_as_sf(dat, coords = c(\"longitude\", \"latitude\"), crs = 4326)\n```\n:::\n\n\n\n\n\n## Understanding the process of Map creation.   \n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nindia %>%  \n  ggplot() + ## Using template\n  geom_sf() + ## Creating a Base map.\n  labs(title = \"India map\", ## Adding Title.\n       subtitle = \"For Workshops\") + ## Adding sub-title. \n  ggspatial::annotation_scale(location = \"bl\") + ## Describing Distance and Scale.\n  ggspatial::annotation_north_arrow(location = \"tr\") + ## Direction symbols.\n  xlab(\"Longitude\") + ## Adding axis labels  \n  ylab(\"Latitude\") +\n  geom_text(aes(x = 87.5, y = 10.3, label = \"Credits: AMCHSS, SCTIMST\"), ## Acknowledging Credits.\n             color = \"black\", check_overlap = T, size = 3)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in geom_text(aes(x = 87.5, y = 10.3, label = \"Credits: AMCHSS, SCTIMST\"), : All aesthetics have length 1, but the data has 36 rows.\nℹ Please consider using `annotate()` or provide this layer with data containing\n  a single row.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nScale on map varies by more than 10%, scale bar may be inaccurate\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](spatial_data_visual_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\n\n### Adding labels and legends.\n\n:::{style=\"text-align:justify\"}\n\nAddition of labels and legends is optional in map making. In the India map, we have just used above for demonstration,\n\n:::\n\n### Option 01 for adding labels: Use of 'geom_sf_label()' function.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#adding abbreviations\nindia$abbr <- c(\"LA\",\"AP\",\n              \"AR\", \"AS\",\n              \"BR\", \"CH\",\n              \"CT\",\n              \"DDDN\", \"DL\",\n              \"GA\", \"GJ\",\n              \"HR\", \"HP\",\n              \"JH\", \"KA\",\n              \"KL\", \"MP\",\n              \"MH\",\"MN\",\n              \"ML\", \"MZ\",\n              \"NL\", \"OR\",\n              \"PY\", \"PB\",\n              \"RJ\", \"SK\",\n              \"TN\", \"TR\",\n              \"UP\", \"UT\",\n              \"WB\", \"TG\",\n              \"JK\", \"LD\", \"AN\")\n### labeling abbreviations\nindia %>%  \n  ggplot() + ## Using template\n  geom_sf() + ## Creating a Base map.\n  labs(title = \"India map\", ## Adding Title.\n       subtitle = \"For Workshops\") + ## Adding sub-title. \n  ggspatial::annotation_scale(location = \"bl\") + ## Describing Distance and Scale.\n  ggspatial::annotation_north_arrow(location = \"tr\") + ## Direction symbols.\n  xlab(\"Longitude\") + ## Adding axis labels  \n  ylab(\"Latitude\") +\n  geom_text(aes(x = 87.5, y = 10.3, label = \"Credits: AMCHSS, SCTIMST\"), ## Acknowledging Credits.\n             color = \"black\", check_overlap = T, size = 3) +\n  geom_sf_label(aes(label = abbr))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in geom_text(aes(x = 87.5, y = 10.3, label = \"Credits: AMCHSS, SCTIMST\"), : All aesthetics have length 1, but the data has 36 rows.\nℹ Please consider using `annotate()` or provide this layer with data containing\n  a single row.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nScale on map varies by more than 10%, scale bar may be inaccurate\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](spatial_data_visual_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n\n\n### Option 2 for adding labels: Use of centroids.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Adding centroids\n\nindia <- cbind(india, st_coordinates(st_centroid(india)))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: st_centroid assumes attributes are constant over geometries\n```\n\n\n:::\n\n```{.r .cell-code}\n## plot\nindia %>%  \n  ggplot() + ## Using template\n  geom_sf() + ## Creating a Base map.\n  labs(title = \"India map\", ## Adding Title.\n       subtitle = \"For Workshops\") + ## Adding sub-title. \n  ggspatial::annotation_scale(location = \"bl\") + ## Describing Distance and Scale.\n  ggspatial::annotation_north_arrow(location = \"tr\") + ## Direction symbols.\n  xlab(\"Longitude\") + ## Adding axis labels  \n  ylab(\"Latitude\") +\n  geom_text(aes(x = 87.5, y = 10.3, label = \"Credits: AMCHSS, SCTIMST\"), ## Acknowledging Credits.\n             color = \"black\", check_overlap = T, size = 3) +\n  geom_text(aes(x = X, y = Y, label = abbr),\n            color = \"black\", fontface = \"bold\", check_overlap = T, size = 2)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in geom_text(aes(x = 87.5, y = 10.3, label = \"Credits: AMCHSS, SCTIMST\"), : All aesthetics have length 1, but the data has 36 rows.\nℹ Please consider using `annotate()` or provide this layer with data containing\n  a single row.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nScale on map varies by more than 10%, scale bar may be inaccurate\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](spatial_data_visual_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n\n## Visualisation of point data.  \n\n:::{style=\"text-align:justify\"}\n\n**Kindly note: For the purpose of clarity on a particular aspect of the map, we will avoid placing all components of a map across the session. This is important to understand that when communicating maps/ figures, all components should be present.**\n\n:::\n\n### Dot Maps.  \n\n:::{style=\"text-align:justify\"}\n\nThe simplest method to visualize disease occurrence patterns is creation of dot maps. They help us understand spatial dependencies in disease occurrence. The spatial clustering of a disease is suggestive of factors present/ absent in locations with high disease occurrence as compared to locations with low disease occurrence. Thus, point maps provides visual tool for providing estimates of Spatial Clustering. Important limitation of these dot maps is the inability to visualize independent events as the number of observations increase or multiple events are observed at the same location. To overcome the same methods such as smoothing, rasterization and dot density maps is recommended.\n\n:::\n\n### Illustrative Example\n\nLet us create a dot map of dengue cases on Kerala map.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Dot map of Dengue occurrence \nggplot()+\n  geom_sf(data = kerala)+\n  geom_sf(data = dat)\n```\n\n::: {.cell-output-display}\n![](spatial_data_visual_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n\n\nAs seen above, all the cases are seen clustered in lower part of Kerala. Hence, we will subset Kerala map and plot again.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntvm <- kerala %>% \n  filter(district == \"Thiruvananthapuram\")\n\nggplot()+\n  geom_sf(data = tvm)+\n  geom_sf(data = dat)\n```\n\n::: {.cell-output-display}\n![](spatial_data_visual_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n\n\nLets separate the cases according to gender distribution.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot()+\n  geom_sf(data = tvm)+\n  geom_sf(data = dat, aes(color = sex1))+ #To change size, use size argument in aes\n  labs(title = \"Dengue occurence in Trivandrum\",\n       subtitle = \"Color according to gender.\",\n       color = \"Sex\")+\n  xlab(\"Longitude\")+\n  ylab(\"Latitude\")+\n  ggspatial::annotation_north_arrow(location = \"br\")+\n  ggspatial::annotation_scale(location = \"bl\")\n```\n\n::: {.cell-output-display}\n![](spatial_data_visual_files/figure-html/unnamed-chunk-11-1.png){width=576}\n:::\n:::\n\n\n\n\n## Visualisation of aggregate data \n\n### Choropleth Maps  \n\n:::{style=\"text-align:justify\"}\n\nThe term \"choropleth\" is derived from Greek words $Khoros$ meaning \"place\" and $plethein$ meaning \"full\". In choropleth maps, aggregated value for a given area forms the basis of visual representation. The three major challanges in intrepretation of choropleth maps arise from large area polygons, Modified Unit Area Problem, and presence of skewed data. Deliberation on these issues, creation of cartograms, data transformation methods such Box-Cox transformations and multi-level analysis are recommended to overcome these limitations. \n\n:::\n\n### Example\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Aggregate dengue occurence based on polygon file\njoined <- st_join(dat, tvm)\n\naggregated <- joined %>% \n  group_by(joined$block) %>% \n  summarise(cases = n()) \n\nchoropleth <- st_join(tvm, aggregated)\n\n## Plot choropleth map\nnames(choropleth)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"join_count\"   \"area\"         \"code\"         \"panchayat\"    \"block\"       \n [6] \"municipal\"    \"corporate\"    \"district\"     \"location\"     \"stateid\"     \n[11] \"districtid\"   \"hospitalid\"   \"nameofhos\"    \"typeofhos\"    \"placename\"   \n[16] \"d\"            \"m\"            \"s\"            \"x\"            \"d1\"          \n[21] \"m1\"           \"s1\"           \"y\"            \"postoffice\"   \"hosattach\"   \n[26] \"pincode\"      \"lobodyname\"   \"lobodytype\"   \"phoneno\"      \"bedcount\"    \n[31] \"timing\"       \"ambuservi\"    \"crsavailab\"   \"crsnameadd\"   \"hostiming\"   \n[36] \"doctors\"      \"nurses\"       \"paramedics\"   \"ambientser\"   \"wastedispo\"  \n[41] \"facility\"     \"service\"      \"departname\"   \"no_of_asha\"   \"no_of_jphn\"  \n[46] \"joined$block\" \"cases\"        \"geometry\"    \n```\n\n\n:::\n\n```{.r .cell-code}\nggplot()+\n  geom_sf(data = choropleth, aes(fill = cases))\n```\n\n::: {.cell-output-display}\n![](spatial_data_visual_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n\n\n\n## Inset maps\n\n:::{style=\"text-align:justify\"}\n\nTo provide understanding of the study location, inset maps are useful. \n\n:::\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](spatial_data_visual_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "spatial_data_visual_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}